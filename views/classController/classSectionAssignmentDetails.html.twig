{% extends "dashboard.html.twig" %}
{% block title %}
	{{ parent() }}
	Devoir
	{{ assignment.name }}
{% endblock %}
{% block content %}
	{% do clear_session_alert() %}
	<div class="app-body-main-content">
		<section class="page-section">
			<div class="page-breacrumb">
				<nav aria-label="breadcrumb">
					<ol class="breadcrumb">
						<li class="breadcrumb-item">
							<a href="/dashboard/classes">
								{% if session.user.role == 'admin' %}Classes{% else %}Mes Classes
								{% endif %}
							</a>
							<svg width="10" height="10" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</li>
						<li class="breadcrumb-item">
							{{ class.name }}
							<svg width="10" height="10" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</li>
						<li class="breadcrumb-item">
							<a href="/dashboard/classes/{{ class.id }}/sections">
								Sections
							</a>
							<svg width="10" height="10" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</li>
						<li class="breadcrumb-item">
							{{ section.name }}
							<svg width="10" height="10" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</li>
						<li class="breadcrumb-item">
							<a href="/dashboard/classes/{{ class.id }}/sections/{{ section.id }}/assignments">
								Devoirs
							</a>
							<svg width="10" height="10" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
								<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
							</svg>
						</li>
						<li class="breadcrumb-item active" aria-current="page">
							{{ assignment.name }}
						</li>
					</ol>
				</nav>
			</div>
			<div class="overlay" id="submit">
				<a href="#" class="overlay-content" href="#"></a>
				<div class="popup" style="max-height: 80vh; overflow-y: auto;">
					<a href="#" class="close-btn">&times;</a>
					<h1>Soumettre votre devoir</h1>
					<form action="/dashboard/classes/{{ class.id }}/sections/{{ section.id }}/assignments/{{ assignment.id }}/submit" method="POST" enctype="multipart/form-data">
						<div class="form-part">
							<label for="file">Fichiers</label>
							<label class="file-input" id="drop-area" for="file">
								<input type="file" name="instruction_files[]" id="file" accept=".jpg,.jpeg,.png,.gif,.zip,.rar,.7z,.tar,.gz,.txt,.ppt,.pptx,.doc,.docx,.pdf" multiple>
								<p>Sélectionner ou glisser-déposer les fichiers ici.</p>
								<p>Vous pouvez téléverser jusqu'à 10 fichiers maximum.</p>
								<p id="file-info">
									Aucun fichier sélectionné
								</p>
							</label>
						</div>
						<button type="submit">
							Soumettre mon devoir
						</button>
					</form>
				</div>
			</div>
			<div class="overlay" id="cancel">
				<a href="#" class="overlay-content" href="#"></a>
				<div class="popup" style="max-height: 80vh; overflow-y: auto;">
					<a href="#" class="close-btn">&times;</a>
					<h1>Annuler la soumission</h1>
					<form action="/dashboard/classes/{{ class.id }}/sections/{{ section.id }}/assignments/{{ assignment.id }}/cancel" method="POST">
						<div class="form-part">
							<p>Êtes-vous certain de vouloir annuler la soumission de ce devoir ? Vous pourrez le soumettre à nouveau après l'annulation, tant que la date limite de soumission n'est pas dépassée.</p>

						</div>
						<button type="submit" class="danger">
							Annuler la soumission
						</button>
					</form>
				</div>
			</div>
			{% if session.alert and session.alert.context == 'global' %}
				<p class="{{ session.alert.status == 'error' ? 'error-message' : 'success-message' }}" style="margin-bottom: 20px;">
					{{ session.alert.message }}
				</p>
			{% endif %}
			{% if assignment.endPeriod|date('Y-m-d') < getTodayDate()|date('Y-m-d') %}
				<div class="assignment-alert">
					<svg width="18px" height="18px" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<path fill-rule="evenodd" clip-rule="evenodd" d="M5.25 10.0546V8C5.25 4.27208 8.27208 1.25 12 1.25C15.7279 1.25 18.75 4.27208 18.75 8V10.0546C19.8648 10.1379 20.5907 10.348 21.1213 10.8787C22 11.7574 22 13.1716 22 16C22 18.8284 22 20.2426 21.1213 21.1213C20.2426 22 18.8284 22 16 22H8C5.17157 22 3.75736 22 2.87868 21.1213C2 20.2426 2 18.8284 2 16C2 13.1716 2 11.7574 2.87868 10.8787C3.40931 10.348 4.13525 10.1379 5.25 10.0546ZM6.75 8C6.75 5.10051 9.10051 2.75 12 2.75C14.8995 2.75 17.25 5.10051 17.25 8V10.0036C16.867 10 16.4515 10 16 10H8C7.54849 10 7.13301 10 6.75 10.0036V8Z" fill="#000000"/>
					</svg>
					<p>Vous ne pouvez plus annuler ou soumettre ce devoir, la date limite de soumission est dépassée.</p>
				</div>
			{% endif %}
			<div class="assignment-card">
				<div class="assignment-card-header-content">
					<h1>{{ assignment.name }}</h1>
					{% if session.user.role == 'student' %}
						{% set endDate = assignment.endPeriod|date('Y-m-d') %}
						{% set todayDate = getTodayDate()|date('Y-m-d') %}
						{% if endDate >= todayDate %}
							{% if assignment.files|length > 0 %}
								<a href="#cancel" class="danger">Annuler la remise</a>
							{% else %}
								<a href="#submit">Soumettre mon devoir</a>
							{% endif %}
						{% else %}
							{% if assignment.files|length > 0 %}
								{% set submissionDate = assignment.files[0].createdAt|date('Y-m-d') %}
								{% if submissionDate <= endDate %}
									<div class="assignment-state submitted">
										<svg width="20px" height="20px" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M9.5 2C8.67157 2 8 2.67157 8 3.5V4.5C8 5.32843 8.67157 6 9.5 6H14.5C15.3284 6 16 5.32843 16 4.5V3.5C16 2.67157 15.3284 2 14.5 2H9.5Z" fill="currentColor"/>
											<path fill-rule="evenodd" clip-rule="evenodd" d="M6.5 4.03662C5.24209 4.10719 4.44798 4.30764 3.87868 4.87694C3 5.75562 3 7.16983 3 9.99826V15.9983C3 18.8267 3 20.2409 3.87868 21.1196C4.75736 21.9983 6.17157 21.9983 9 21.9983H15C17.8284 21.9983 19.2426 21.9983 20.1213 21.1196C21 20.2409 21 18.8267 21 15.9983V9.99826C21 7.16983 21 5.75562 20.1213 4.87694C19.552 4.30764 18.7579 4.10719 17.5 4.03662V4.5C17.5 6.15685 16.1569 7.5 14.5 7.5H9.5C7.84315 7.5 6.5 6.15685 6.5 4.5V4.03662ZM15.5117 12.5483C15.8146 12.2657 15.8309 11.7911 15.5483 11.4883C15.2657 11.1855 14.7911 11.1691 14.4883 11.4517L10.7143 14.9741L9.51174 13.8517C9.20893 13.5691 8.73434 13.5855 8.45171 13.8883C8.16909 14.1911 8.18545 14.6657 8.48826 14.9483L10.2025 16.5483C10.4907 16.8172 10.9379 16.8172 11.226 16.5483L15.5117 12.5483Z" fill="currentColor"/>
										</svg>
										<span>Vous avez rendu ce devoir</span>
									</div>
								{% elseif submissionDate > endDate and assignment.allowLateSubmission %}
									<div class="assignment-state submitted-late">
										<svg width="20px" height="20px" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M9.5 2C8.67157 2 8 2.67157 8 3.5V4.5C8 5.32843 8.67157 6 9.5 6H14.5C15.3284 6 16 5.32843 16 4.5V3.5C16 2.67157 15.3284 2 14.5 2H9.5Z" fill="currentColor"/>
											<path fill-rule="evenodd" clip-rule="evenodd" d="M6.5 4.03662C5.24209 4.10719 4.44798 4.30764 3.87868 4.87694C3 5.75562 3 7.16983 3 9.99826V15.9983C3 18.8267 3 20.2409 3.87868 21.1196C4.75736 21.9983 6.17157 21.9983 9 21.9983H15C17.8284 21.9983 19.2426 21.9983 20.1213 21.1196C21 20.2409 21 18.8267 21 15.9983V9.99826C21 7.16983 21 5.75562 20.1213 4.87694C19.552 4.30764 18.7579 4.10719 17.5 4.03662V4.5C17.5 6.15685 16.1569 7.5 14.5 7.5H9.5C7.84315 7.5 6.5 6.15685 6.5 4.5V4.03662ZM15.5117 12.5483C15.8146 12.2657 15.8309 11.7911 15.5483 11.4883C15.2657 11.1855 14.7911 11.1691 14.4883 11.4517L10.7143 14.9741L9.51174 13.8517C9.20893 13.5691 8.73434 13.5855 8.45171 13.8883C8.16909 14.1911 8.18545 14.6657 8.48826 14.9483L10.2025 16.5483C10.4907 16.8172 10.9379 16.8172 11.226 16.5483L15.5117 12.5483Z" fill="currentColor"/>
										</svg>
										<span>Vous avez rendu ce devoir en retard</span>
									</div>
								{% endif %}
							{% else %}
								<div class="assignment-state not-submitted">
									<svg width="20px" height="20px" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path d="M9.5 2C8.67157 2 8 2.67157 8 3.5V4.5C8 5.32843 8.67157 6 9.5 6H14.5C15.3284 6 16 5.32843 16 4.5V3.5C16 2.67157 15.3284 2 14.5 2H9.5Z" fill="currentColor"/>
										<path fill-rule="evenodd" clip-rule="evenodd" d="M3.87868 4.87694C4.44798 4.30764 5.24209 4.10719 6.5 4.03662V4.5C6.5 6.15685 7.84315 7.5 9.5 7.5H14.5C16.1569 7.5 17.5 6.15685 17.5 4.5V4.03662C18.7579 4.10719 19.552 4.30764 20.1213 4.87694C21 5.75562 21 7.16983 21 9.99826V15.9983C21 18.8267 21 20.2409 20.1213 21.1196C19.2426 21.9983 17.8284 21.9983 15 21.9983H9C6.17157 21.9983 4.75736 21.9983 3.87868 21.1196C3 20.2409 3 18.8267 3 15.9983V9.99826C3 7.16983 3 5.75562 3.87868 4.87694ZM12 13.4394L10.0303 11.4697C9.73744 11.1768 9.26256 11.1768 8.96967 11.4697C8.67678 11.7626 8.67678 12.2374 8.96967 12.5303L10.9394 14.5L8.96969 16.4697C8.6768 16.7626 8.6768 17.2374 8.96969 17.5303C9.26258 17.8232 9.73746 17.8232 10.0304 17.5303L12 15.5607L13.9696 17.5303C14.2625 17.8232 14.7374 17.8232 15.0303 17.5303C15.3232 17.2374 15.3232 16.7625 15.0303 16.4697L13.0607 14.5L15.0303 12.5303C15.3232 12.2375 15.3232 11.7626 15.0303 11.4697C14.7374 11.1768 14.2626 11.1768 13.9697 11.4697L12 13.4394Z" fill="currentColor"/>
									</svg>
									<span>Vous n'avez pas rendu ce devoir</span>
								</div>
							{% endif %}
						{% endif %}
					{% endif %}
				</div>
				<p class="assignment-description">{{ assignment.description }}</p>
				{% if assignment.instructionFiles|length > 0 %}
					<div class="assignment-card-instructions-files">
						<h2>Fichiers joints par l'enseignant :</h2>
						<ul>
							{% for file in assignment.instructionFiles %}
								<li>
									<p>{{ file.name }}</p>
									<a href="/dashboard/classes/{{ class.id }}/sections/{{ section.id }}/assignments/{{ assignment.id }}/files/{{ file.id }}/download">
										<svg width="20px" height="20px" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M19.3517 7.61665L15.3929 4.05375C14.2651 3.03868 13.7012 2.53114 13.0092 2.26562L13 5.00011C13 7.35713 13 8.53564 13.7322 9.26787C14.4645 10.0001 15.643 10.0001 18 10.0001H21.5801C21.2175 9.29588 20.5684 8.71164 19.3517 7.61665Z" fill="currentColor"/>
											<path fill-rule="evenodd" clip-rule="evenodd" d="M10 22H14C17.7712 22 19.6569 22 20.8284 20.8284C22 19.6569 22 17.7712 22 14V13.5629C22 12.6901 22 12.0344 21.9574 11.5001H18L17.9051 11.5001C16.808 11.5002 15.8385 11.5003 15.0569 11.3952C14.2098 11.2813 13.3628 11.0198 12.6716 10.3285C11.9803 9.63726 11.7188 8.79028 11.6049 7.94316C11.4998 7.16164 11.4999 6.19207 11.5 5.09497L11.5092 2.26057C11.5095 2.17813 11.5166 2.09659 11.53 2.01666C11.1214 2 10.6358 2 10.0298 2C6.23869 2 4.34315 2 3.17157 3.17157C2 4.34315 2 6.22876 2 10V14C2 17.7712 2 19.6569 3.17157 20.8284C4.34315 22 6.22876 22 10 22ZM7.98704 19.0472C8.27554 19.3176 8.72446 19.3176 9.01296 19.0472L11.013 17.1722C11.3151 16.8889 11.3305 16.4142 11.0472 16.112C10.7639 15.8099 10.2892 15.7945 9.98704 16.0778L9.25 16.7688L9.25 13.5C9.25 13.0858 8.91421 12.75 8.5 12.75C8.08579 12.75 7.75 13.0858 7.75 13.5V16.7688L7.01296 16.0778C6.71077 15.7945 6.23615 15.8099 5.95285 16.112C5.66955 16.4142 5.68486 16.8889 5.98704 17.1722L7.98704 19.0472Z" fill="currentColor"/>
										</svg>
										Télécharger
									</a>
								</li>
							{% endfor %}
						</ul>
					</div>
				{% endif %}
				{% if assignment.files|length > 0 %}
					<div class="assignment-card-instructions-files">
						<h2>Votre soumission :</h2>

						<ul>
							{% for file in assignment.files %}
								<li>
									<p>{{ file.name }}</p>
									<a href="/dashboard/files/{{ file.id }}/download">
										<svg width="20px" height="20px" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
											<path d="M19.3517 7.61665L15.3929 4.05375C14.2651 3.03868 13.7012 2.53114 13.0092 2.26562L13 5.00011C13 7.35713 13 8.53564 13.7322 9.26787C14.4645 10.0001 15.643 10.0001 18 10.0001H21.5801C21.2175 9.29588 20.5684 8.71164 19.3517 7.61665Z" fill="currentColor"/>
											<path fill-rule="evenodd" clip-rule="evenodd" d="M10 22H14C17.7712 22 19.6569 22 20.8284 20.8284C22 19.6569 22 17.7712 22 14V13.5629C22 12.6901 22 12.0344 21.9574 11.5001H18L17.9051 11.5001C16.808 11.5002 15.8385 11.5003 15.0569 11.3952C14.2098 11.2813 13.3628 11.0198 12.6716 10.3285C11.9803 9.63726 11.7188 8.79028 11.6049 7.94316C11.4998 7.16164 11.4999 6.19207 11.5 5.09497L11.5092 2.26057C11.5095 2.17813 11.5166 2.09659 11.53 2.01666C11.1214 2 10.6358 2 10.0298 2C6.23869 2 4.34315 2 3.17157 3.17157C2 4.34315 2 6.22876 2 10V14C2 17.7712 2 19.6569 3.17157 20.8284C4.34315 22 6.22876 22 10 22ZM7.98704 19.0472C8.27554 19.3176 8.72446 19.3176 9.01296 19.0472L11.013 17.1722C11.3151 16.8889 11.3305 16.4142 11.0472 16.112C10.7639 15.8099 10.2892 15.7945 9.98704 16.0778L9.25 16.7688L9.25 13.5C9.25 13.0858 8.91421 12.75 8.5 12.75C8.08579 12.75 7.75 13.0858 7.75 13.5V16.7688L7.01296 16.0778C6.71077 15.7945 6.23615 15.8099 5.95285 16.112C5.66955 16.4142 5.68486 16.8889 5.98704 17.1722L7.98704 19.0472Z" fill="currentColor"/>
										</svg>
										Télécharger
									</a>
								</li>
							{% endfor %}
						</ul>
					</div>
				{% endif %}


			</div>

		</section>
	</div>
{% endblock %}
{% block js %}
	{{ parent() }}
	<script src="/assets/js/uploadarea.js"></script>
{% endblock %}
